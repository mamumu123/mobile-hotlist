## æ¦‚è¿°
æœ¬æ–‡ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ `uni-app` å°†ä¸€ä¸ª web åº”ç”¨å¿«é€Ÿå°è£…æˆ`ç§»åŠ¨ç«¯ï¼ˆå®‰å“ï¼‰åº”ç”¨`, å¹¶ä¸”å¯¹æ•°æ®æºä»£ç è¿›è¡Œåˆ†æï¼Œæ‰©å±•ä¸€ä¸ªæ–°çš„æ¥å£ï¼š

- å¦‚ä½•ç”¨ uni-app å°è£…å®¢æˆ·ç«¯åº”ç”¨;
- åˆ†ææ•°æ®æº node ä»“åº“ï¼Œæ‰©å±•æ–°çš„æ¥å£,å¢åŠ  github æ¦œå•;
Â·
## å…³é”®è¯
uni-appã€å®¢æˆ·ç«¯ã€ å®‰å“ã€çƒ­æ¦œã€å¥—å£³ã€koa

## æ•ˆæœæˆªå›¾
![æˆªå±2023-07-28 16.29.02.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44be166dd8574897bf7cf125d494869b~tplv-k3u1fbpfcp-watermark.image?)

## ä»£ç ä»“åº“
[mobile-hotlist](https://github.com/mamumu123/mobile-hotlist)
ï¼ˆå¸®æˆ‘ç‚¹ä¸ªå…è´¹çš„ star å§ğŸ¥°,æ‚¨çš„ç‚¹èµæ˜¯æˆ‘å‰è¿›çš„åŠ¨åŠ›ï¼‰


## é¡¹ç›®èƒŒæ™¯

### é¡¹ç›®åˆ¶ä½œåŸå› 
æœ¬äººå¹³æ—¶å–œæ¬¢åˆ·å„ç§æ–°é—»ï¼ˆæ¶ˆæ¯ï¼‰ï¼Œä½†æ˜¯ä¸€å †åº”ç”¨ + åª’ä½“èµ„æºï¼Œä½¿å¾—æ‰‹æœºå†…å­˜æ€»æ˜¯å çš„æ»¡æ»¡çš„ï¼Œéœ€è¦ç»å¸¸éœ€è¦æ¸…ç†å†…å­˜ã€‚
å…¶ä¸­ï¼Œå¾ˆå¤šåº”ç”¨åªæ˜¯ä¸ºäº†åˆ·æ–°é—»ï¼ˆæ¶ˆæ¯ï¼‰ï¼Œä½†æ˜¯å ç”¨äº†å¾ˆå¤šçš„å†…å­˜ã€‚ä¸ºäº†å‡å°‘å†…å­˜çš„å ç”¨ï¼Œæ‰€ä»¥æƒ³è¦å¼„ä¸€ä¸ªæ¦œå•åˆé›†æ¥æ›¿ä»£è¿™äº›åº”ç”¨ã€‚

![2023.08.01_19.15.43.jpg](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bb0ab47367454355a5a2a4db0ad86ddb~tplv-k3u1fbpfcp-watermark.image?)

åœ¨ github æœ‰å¾ˆå¤šç°æˆçš„åº”ç”¨ï¼Œå…¶ä¸­ä¸€ä¸ªé¡¹ç›® [DailyHot](https://github.com/imsyy/DailyHotApi) æ¯”è¾ƒä¸é”™ï¼Œå¹¶ä¸”é€‚é…äº†ç§»åŠ¨ç«¯ã€‚æ‰€ä»¥å‡†å¤‡å°†è¿™ä¸ª web åº”ç”¨å°è£…æˆï¼ˆå®‰å“ï¼‰å®¢æˆ·ç«¯, æ¥ç»™è‡ªå·±ä½¿ç”¨ã€‚

## åŠ¨æ‰‹è¯•è¯•
ä¸ºäº†å¿«é€Ÿå¥—å£³ï¼Œå¯ä»¥å®ç°çš„æŠ€æœ¯æ ˆæœ‰å¾ˆå¤šï¼Œæ¯”å¦‚ `flutter`ã€ `react-native`ã€`uni-app` ç­‰ã€‚æœ€åé€‰æ‹©äº† `uni-app` è¿›è¡Œå°è£…ï¼ŒåŸå› åŒ…æ‹¬ï¼š
- å‰ç«¯å‹å¥½ï¼Œä¸éœ€è¦å­¦ä¹ æ–°çš„è¯­è¨€ï¼›
- è·¨ç«¯æ”¯æŒå°ç¨‹åºï¼›

> uni-app æ˜¯ä¸€ä¸ªä½¿ç”¨ Vue.js å¼€å‘æ‰€æœ‰å‰ç«¯åº”ç”¨çš„æ¡†æ¶ï¼Œå¼€å‘è€…ç¼–å†™ä¸€å¥—ä»£ç ï¼Œå¯å‘å¸ƒåˆ°iOSã€Androidã€Webï¼ˆå“åº”å¼ï¼‰ã€ä»¥åŠå„ç§å°ç¨‹åºï¼ˆå¾®ä¿¡/æ”¯ä»˜å®/ç™¾åº¦/å¤´æ¡/é£ä¹¦/QQ/å¿«æ‰‹/é’‰é’‰/æ·˜å®ï¼‰ã€å¿«åº”ç”¨ç­‰å¤šä¸ªå¹³å°

å…¶å®å¾®ä¿¡å°ç¨‹åºåº”è¯¥æ˜¯æœ€å¥½çš„åœºæ™¯ï¼Œä¾¿äºæ‰“å¼€åˆä¸éœ€è¦å®‰è£…ã€‚ä½†æ˜¯å°ç¨‹åºçš„é™åˆ¶å¤ªå¤šï¼Œè€Œä¸”ä¸å…è®¸ä¸ªäººå¼€å‘è€…ä½¿ç”¨ `web-view`, éœ€è¦ä¹‹åå†æƒ³åŠæ³•ã€‚

### åˆå§‹åŒ–é¡¹ç›®
é¦–å…ˆä½¿ç”¨ `HBuilderX` æ–°å»ºä¸€ä¸ª `uni-app` é¡¹ç›®ï¼Œç„¶ååœ¨`pages/index/index`ä¸­å¢åŠ  web-view ç»„ä»¶,å°†é¡µé¢åµŒå…¥å°±å¯ä»¥äº†ã€‚

>web-view æ˜¯ä¸€ä¸ª web æµè§ˆå™¨ç»„ä»¶ï¼Œå¯ä»¥ç”¨æ¥æ‰¿è½½ç½‘é¡µçš„å®¹å™¨

```html
<template>
	<view>
		<web-view src="https://hot.imsyy.top/#/"></web-view>
	</view>
</template>
```


### è°ƒè¯•-å®‰å“æ¨¡æ‹Ÿå™¨
ç§»åŠ¨ç«¯è°ƒè¯•å¯ä»¥é€šè¿‡æ¨¡æ‹Ÿå™¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡è¿æ¥çœŸæœºè¿›è¡Œè°ƒè¯•ã€‚ä¸ºäº†è°ƒè¯•æ–¹ä¾¿ï¼Œå†³å®šåœ¨æœ¬åœ°å®‰è£…å®˜æ–¹æ¨¡æ‹Ÿå™¨ã€‚

#### ä¸‹è½½æ¨¡æ‹Ÿå™¨
æ¨¡æ‹Ÿå™¨æœ‰å¾ˆå¤šï¼Œä½œä¸ºæ–°æ‰‹ï¼Œä¸‹è½½çš„æ˜¯ [google å®˜æ–¹æ¨¡æ‹Ÿå™¨](https://developer.android.com/studio)ã€‚å®‰è£…æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯é€šè¿‡ç½‘é¡µä¸‹è½½ï¼Œç„¶åä¸€ç›´ç‚¹å‡»`next`ï¼Œç›´åˆ°`finish`ã€‚

#### è¿è¡Œ
åœ¨å®‰è£…å¥½ä»¥åï¼Œæ‰“å¼€æ¨¡æ‹Ÿå™¨ï¼Œå°±å¯ä»¥æŒ‰ç…§ `uni-app` å®˜æ–¹æä¾›çš„[ å®‰è£…æ¨¡æ‹Ÿå™¨æ•™ç¨‹ ](https://uniapp.dcloud.net.cn/tutorial/run/installSimulator.html)å®ç°è”è°ƒã€‚

åœ¨ HBuilderX çš„èœå•æ ç‚¹å‡»ç‚¹å‡» `è¿è¡Œ`ï¼Œç„¶åé€‰æ‹©`è¿è¡Œåˆ°æ‰‹æœºæ¨¡æ‹Ÿå™¨`ï¼Œ`è¿è¡Œåˆ° Android App åŸºåº§`ã€‚

![æˆªå±2023-07-28 16.20.10.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/eb454eea10f642d58b4277ab9144a3ef~tplv-k3u1fbpfcp-watermark.image?)

åœ¨é€‰æ‹©åˆ° emulator-xxx çš„è®¾å¤‡ä»¥åï¼Œç‚¹å‡»è¿è¡Œã€‚

![ä¼ä¸šå¾®ä¿¡æˆªå›¾_af92892b-db18-4353-92d6-d25470ea30a4.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7d2e22eb38f449e940640d1864273d2~tplv-k3u1fbpfcp-watermark.image?)

ç„¶åç­‰å¾…ä¸€ä¸‹ï¼Œå°±å¯ä»¥æŸ¥çœ‹æ•ˆæœäº†ã€‚

![æˆªå±2023-07-28 16.29.02.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/44be166dd8574897bf7cf125d494869b~tplv-k3u1fbpfcp-watermark.image?)

å¦‚æœåœ¨æ¨¡æ‹Ÿå™¨çœ‹åˆ°æ•ˆæœï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥å°±å®Œæˆäº†ã€‚


### æ‰“åŒ…
å¼€å‘å®Œæˆåï¼Œå°±å¯ä»¥å¼€å§‹æ‰“åŒ…æˆ `app` åœ¨æ‰‹æœºç«¯ä½“éªŒæ•ˆæœäº†ã€‚(æœ¬äººæ‰‹æœºä¸ºå®‰å“æœºï¼Œæ‰€ä»¥ä¸‹æ–¹åˆ†äº«çš„æ˜¯å®‰å“åº”ç”¨çš„æ‰“åŒ…)

`uni-app` åœ¨æ‰“åŒ…æ—¶æä¾›äº†äº‘æ‰“åŒ…çš„æ–¹å¼ï¼Œå¯ä»¥ä¸éœ€è¦é…ç½®æœ¬åœ°å°±æ‰“åŒ…æˆåŠŸã€‚([æ‰“åŒ…ä¸ºåŸç”Ÿapp](https://uniapp.dcloud.net.cn/quickstart-hx.html#%E6%89%93%E5%8C%85%E4%B8%BA%E5%8E%9F%E7%94%9Fapp))

![æˆªå±2023-07-31 11.16.32.png](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7ea632b2e5894efb93a6c1caad50ed20~tplv-k3u1fbpfcp-watermark.image?)

æ§åˆ¶å°ä¼šæ˜¾ç¤ºæ‰“åŒ…è¿›åº¦ï¼Œç„¶ååœ¨ç­‰å¾…å‡ åˆ†é’Ÿä»¥åï¼Œå°±å¯ä»¥åœ¨è·¯å¾„`unpackage/release/apk/`çœ‹åˆ°å¯ä»¥å®‰è£…çš„ `apk æ–‡ä»¶`äº†ï¼Œä¼ é€’åˆ°æ‰‹æœºï¼Œç„¶ååŒå‡»å°±å¯ä»¥å®‰è£…äº†ã€‚


### é‡åˆ°çš„é—®é¢˜
#### æ¨¡æ‹Ÿå™¨å®‰è£… sdk è¾ƒæ…¢
åœ¨æ¨¡æ‹Ÿå™¨å®‰è£… sdk æ—¶ï¼Œä¼šç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•å®‰è£…ã€‚é€šè¿‡æŸ¥è¯¢ï¼Œå¯ä»¥é€šè¿‡è®¾ç½® hosts æ¥åŠ é€Ÿä¸‹è½½ã€‚
- ç‚¹å‡» https://ping.chinaz.com/dl.google.com, æ‰¾åˆ°å“åº”æ—¶é—´æœ€å¿« IP åœ°å€ã€‚

![ä¼ä¸šå¾®ä¿¡æˆªå›¾_87d0771f-08d8-49e6-9ac2-cba2b651a9d3.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b1cb5d122b0c4e4d99e7d1a65652eaa6~tplv-k3u1fbpfcp-watermark.image?)

- å°† IP åŠ å…¥åˆ°æœ¬åœ° hosts é…ç½®æ–‡ä»¶ï¼Œå¦‚ mac ç”µè„‘ï¼Œç›´æ¥åœ¨ æ§åˆ¶å°è¾“å…¥ `sudo vim /etc/hosts`, 

```bash
203.208.41.65 dl.google.com
```

#### è¯·æä¾›64ä½ç‰ˆæœ¬è½¯ä»¶åŒ…åå†æäº¤å®¡æ ¸
[è¯·æä¾›64ä½ç‰ˆæœ¬è½¯ä»¶åŒ…åå†æäº¤å®¡æ ¸](https://uniapp.dcloud.net.cn/tutorial/android-store.html#_17%E3%80%81%E8%AF%B7%E6%8F%90%E4%BE%9B64%E4%BD%8D%E7%89%88%E6%9C%AC%E8%BD%AF%E4%BB%B6%E5%8C%85%E5%90%8E%E5%86%8D%E6%8F%90%E4%BA%A4%E5%AE%A1%E6%A0%B8)

#### ä½¿ç”¨ web-view åè·¯ç”±å’Œåº”ç”¨è·¯ç”±æ— æ³•è”åŠ¨
åœ¨çœŸæœºä½“éªŒæ—¶ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜,ç”±äºæ˜¯ä¸€ä¸ªå¥—å£³åº”ç”¨ï¼Œ`web-view` ç›¸å½“äºæ˜¯ä¸€ä¸ª iframe, å†…éƒ¨å’Œå¤–éƒ¨çš„è·¯ç”±æ˜¯æ— æ³•åŒæ­¥çš„ã€‚
å¦‚æœæ˜¯ h5 åº”ç”¨ï¼ŒéåŒæºçš„ iframe ä¼šå› ä¸ºå®‰å…¨ç­–ç•¥ï¼Œå¯¼è‡´åŒæ­¥ä¼šå˜å¾—å¾ˆè‰°éš¾ã€‚ä½†æ˜¯åœ¨å®¢æˆ·ç«¯ï¼Œæ²¡æœ‰è¿™äº›é™åˆ¶ï¼Œå¯ä»¥ä»å¤–é¢æ“ä½œ web-view çš„è·¯ç”±ã€‚

é€šè¿‡ plus.webview.create åˆ›å»º web-viewï¼Œè·å¾—æ“ä½œå¥æŸ„ã€‚
```js
const wv = plus.webview.create("", "custom-webview", {  
  plusrequire: "none", //ç¦æ­¢è¿œç¨‹ç½‘é¡µä½¿ç”¨plusçš„APIï¼Œæœ‰äº›ä½¿ç”¨muiåˆ¶ä½œçš„ç½‘é¡µå¯èƒ½ä¼šç›‘å¬plus.keyï¼Œé€ æˆå…³é—­é¡µé¢æ··ä¹±ï¼Œå¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼ç¦æ­¢  
  'uni-app': 'none', //ä¸åŠ è½½uni-appæ¸²æŸ“å±‚æ¡†æ¶ï¼Œé¿å…æ ·å¼å†²çª  
  top: uni.getSystemInfoSync().statusBarHeight + 44 //æ”¾ç½®åœ¨titleNViewä¸‹æ–¹ã€‚å¦‚æœè¿˜æƒ³åœ¨webviewä¸Šæ–¹åŠ ä¸ªåœ°å€æ çš„ä»€ä¹ˆçš„ï¼Œå¯ä»¥ç»§ç»­é™ä½TOPå€¼  
})  
wv.loadURL(url) 
```

å°†åˆ›å»ºçš„ `web-view` åŠ å…¥åˆ°å½“å‰é¡µé¢
```js
const currentWebview = this.$scope.$getAppWebview(); 
currentWebview.append(wv); 
```

`canBack` çš„å›è°ƒèƒ½çŸ¥é“å½“å‰ `web-view` æ˜¯å¦èƒ½å¤Ÿè¿”å›ä¸Šä¸€é¡µã€‚å¦‚æœå¯ä»¥ï¼Œåˆ™åœ¨é¡µé¢æ¸²æŸ“ä¸€ä¸ª`ä¸Šä¸€é¡µ`çš„æŒ‰é’®ã€‚
```js
const self = this  
wv.addEventListener('loaded', e => {  
  wv.canBack(e => {  
    self.canBack = e.canBack  
    currentWebview.setTitleNViewButtonStyle(0, {  
      color: e.canBack ? '#000' : '#fff',    
    });  
  })  
})  
this.wv = wv  
```

æ³¨å†Œ `onNavigationBarButtonTap`ã€‚ç‚¹å‡»æŒ‰é’®æ—¶ï¼Œåˆ™è°ƒç”¨ `web-view` çš„ `back` å‡½æ•°ï¼Œè¿”å›ä¸Šä¸€é¡µã€‚

```js
onNavigationBarButtonTap (e) {  
  this.handleBack()
}ï¼Œ
methods: {
  handleBack() {
    // #ifdef APP-PLUS
    if (this.wv && this.canBack) {
      this.wv.back()
      return true
    }
    // #endif  
  }
}
```
è¿˜å¯ä»¥æ³¨å†Œ `onBackPress`äº‹ä»¶ï¼Œç›‘å¬å·¦ä¸Šè§’å¯¼èˆªæ æŒ‰é’®åŠå®‰å“è¿”å›é”®ã€‚

```js
onBackPress(e) {  
	// #ifdef APP-PLUS  
	if (this.wv && this.canBack) {  
		this.wv.back()  
		return true  
	}  
	// #endif  
}
```

è¿™æ ·å­ï¼Œå°±å¯ä»¥å®ç°é¡µé¢çš„è¿”å›åŠŸèƒ½äº†ã€‚

## æ‰©å±•æ•°æ®æº

### ä»£ç åœ°å€
[DailyHotApi](https://github.com/mamumu123/DailyHotApi)

### åŠŸèƒ½
èšåˆçƒ­é—¨æ•°æ®çš„ API æ¥å£


### ç»“æ„åˆ†æ
è¿™æ˜¯ä¸€ä¸ªå¾ˆç»å…¸çš„ koa é¡¹ç›®ï¼Œå…¥å£çš„ `index.js`åšäº†åˆå§‹åŒ–ã€é…ç½®ä¸­é—´ä»¶ã€åˆ›å»º http æœåŠ¡ï¼Œç›‘å¬ç«¯å£ç­‰åŠŸèƒ½ã€‚
```js
const Koa = require("koa");
const app = new Koa();
const router = require("./routes");

app.use(/**....*/);

// ä½¿ç”¨è·¯ç”±ä¸­é—´ä»¶
app.use(router.routes());

app.listen(port, () => {
});
```

ç„¶ååœ¨  `./routes/index.js` ä¸­ï¼Œè¿›è¡Œäº†è·¯ç”±çš„æ³¨å†Œï¼Œå¯ä»¥å“åº” `/`, `/all`, `/xxx`, `/xxx/new` ç­‰æ¥å£

#### è·¯ç”±æ³¨å†Œ
é¦–å…ˆè¿›è¡Œè·¯ç”±åˆå§‹åŒ–
```js
const Router = require("koa-router");
const router = new Router();
```

ç›‘å¬è·¯ç”± `/`, è¿”å›`index.html`, æ˜¯ä¸€ä¸ªæ¥å£æ–‡æ¡£é¡µ

```js
// æ ¹ç›®å½•
router.get("/", async (ctx) => {
  await ctx.render("index");
});
```

è¯»å– `routes æ–‡ä»¶å¤¹`ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œè·å¾—æ¯ä¸ªå­è·¯ç”±çš„é…ç½®ã€‚
```js
// éå†æ‰€æœ‰è·¯ç”±æ¨¡å—
fs.readdirSync(__dirname)
  .filter((filename) => filename.endsWith(".js") && filename !== "index.js")
  .forEach((filename) => {
    // ...
  });
```
![æˆªå±2023-08-01 15.45.32.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2f62e60221a44bc8d30e7cb0f510b5e~tplv-k3u1fbpfcp-watermark.image?)

ä»¥æ–‡ä»¶åä½œä¸ºè·¯ç”±åï¼Œè¿›è¡Œè·¯ç”±æ³¨å†Œ
```js
const routerPath = path.join(__dirname, filename);
const routerModule = require(routerPath);
// è‡ªåŠ¨æ³¨å†Œè·¯ç”±
if (routerModule instanceof Router) {
  // å¼•ç”¨è·¯ç”±
  router.use(routerModule.routes());
}
```

è¿™æ ·çƒ­æ¦œè·¯ç”±çš„æ³¨å†Œå°±å®Œæˆäº†ã€‚

### å¢åŠ  github çƒ­æ¦œ
åœ¨ç†é¡ºå‰é¢çš„ä»£ç ç»“æ„ä»¥åï¼Œæˆ‘ä»¬æ¥å¢åŠ ä¸€ä¸ª github æ¦œå•ã€‚

åœ¨ `routes æ–‡ä»¶å¤¹`ä¸‹å¢åŠ ä¸€ä¸ªæ–‡ä»¶ `github.js`ï¼Œç›´æ¥å¤åˆ¶ä¸€ä¸ªå­è·¯ç”±æ–‡ä»¶ï¼Œç„¶åæ”¹ä¸€ä¸‹æ•°æ®æºæ¥å£ï¼Œè¿›è¡Œæ¥å£é€‚é…å³å¯ã€‚

æ‰¾åˆ°ä¸€ä¸ªæ¦œå•æ•°æ®æº `https://e.juejin.cn/resources/github`ï¼Œè¿”å›çš„æ•°æ®æºå¦‚ä¸‹ï¼š

```json
{
  "id": 672877879,
  "url": "https://github.com/MrBl0kcha1ne/SniperBot",
  "username": "MrBl0kcha1ne",
  "reponame": "SniperBot",
  "description": "Earn money with Sniper Bot (Uniswap/Pancakeswap)",
  "lang": "Solidity",
  "langColor": "#ce6c50",
  "starCount": 94,
  "forkCount": 37,
  "owner": {
      "username": "MrBl0kcha1ne",
      "avatar": "https://avatars.githubusercontent.com/u/137830233?v=4",
      "url": "https://github.com/MrBl0kcha1ne"
  },
  "translation": {}
},
```
ä¿®æ”¹ getData æ–¹æ³•ï¼Œè¿›è¡Œæ•°æ®é€‚é…
```js
const getData = (data) => {
  if (!data) return [];
  return data.map((v) => {
    return {
      id: v.id,
      title: v.reponame,
      desc: v.description,
      url: `${v.url}`,
      mobileUrl: `${v.url}`,
    };
  });
};
```

æ•ˆæœå±•ç¤º

![æˆªå±2023-08-01 18.21.19.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d3d64477a82a493696e7418262bd12cc~tplv-k3u1fbpfcp-watermark.image?)


### çŸ¥è¯†ç‚¹æ•´ç†

#### é…ç½®åŠ è½½
dotenv æ˜¯ä¸€ä¸ªé…ç½®åŠ è½½åº“ï¼Œå°†ç¯å¢ƒå˜é‡ä» .env æ–‡ä»¶åŠ è½½åˆ° process.env ä¸­
>loads environment variables from a .env file into process.env

```js
require('dotenv').config()
let domain = process.env.ALLOWED_DOMAIN || "*";
let port = process.env.PORT || 6688;
```


#### ä¸­é—´ä»¶æ³¨å†Œ
ä¸­é—´ä»¶æ˜¯ Koa ä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œå®ƒæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥åœ¨è¯·æ±‚å’Œå“åº”ä¹‹é—´æ‰§è¡Œä¸€äº›æ“ä½œï¼Œä¾‹å¦‚ä¿®æ”¹è¯·æ±‚æˆ–å“åº”ã€è®°å½•æ—¥å¿—ã€å¤„ç†é”™è¯¯ç­‰ã€‚
ä¾‹å¦‚å½“å‰è¿™ä¸ªé¡¹ç›®ï¼Œä¹Ÿæ³¨å†Œäº†å¾ˆå¤šä¸­é—´ä»¶ï¼ŒåŒ…æ‹¬ï¼š

- koa-bodyparser: æ”¯æŒx-www-form-urlencoded, application/jsonç­‰æ ¼å¼çš„è¯·æ±‚ä½“ï¼›
- koa2-cors: é…ç½®è·¨åŸŸè¯·æ±‚ï¼›
- koa-static: æ‰˜ç®¡é™æ€æ–‡ä»¶ï¼Œè¯·æ±‚é™æ€æ–‡ä»¶åç›´æ¥è¿”å›ï¼›
- koa-router: è·¯ç”±ä¸­é—´ä»¶ï¼Œå°†è¯·æ±‚çš„ URL æ˜ å°„åˆ°ç›¸åº”çš„å¤„ç†å‡½æ•°ä¸Šï¼Œä»¥ä¾¿å¤„ç†è¯·æ±‚å’Œç”Ÿæˆå“åº”ã€‚

#### é˜²ç›—é“¾ä¸­é—´ä»¶
é™¤äº†è¿™äº›å¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œè¿˜è‡ªå®šä¹‰äº†ä¸€ä¸ªé˜²ç›—é“¾ä¸­é—´ä»¶ï¼Œèƒ½å¤Ÿæ§åˆ¶å…è®¸è®¿é—®çš„åŸŸåã€‚
ä¸­é—´ä»¶ä¼šæ£€æŸ¥è¯·æ±‚å¤´ä¸­çš„ Referer å­—æ®µï¼Œè·å–è¯·æ±‚æ¥æºçš„åŸŸåï¼Œå¹¶åˆ¤æ–­è¯¥åŸŸåæ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚å¦‚æœåœ¨ç™½åå•ä¸­ï¼Œåˆ™ç»§ç»­æ‰§è¡Œä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼›å¦åˆ™ï¼Œè¿”å› 403 Forbidden é”™è¯¯ã€‚
```js
const domain = process.env.ALLOWED_DOMAIN || "*";

app.use(async (ctx, next) => {
  if (domain === "*") {
    await next();
  } else {
    if (ctx.headers.origin === domain || ctx.headers.referer === domain) {
      await next();
    } else {
      ctx.status = 403;
      ctx.body = {
        code: 403,
        message: "è¯·é€šè¿‡æ­£ç¡®çš„åŸŸåè®¿é—®",
      };
    }
  }
});
```

#### cacheï¼ˆç¼“å­˜ï¼‰
node-cache æ˜¯ä¸€ä¸ªç®€å•æ˜“ç”¨çš„ Node.js ç¼“å­˜æ¨¡å—ï¼Œå¯ä»¥ç”¨äºç¼“å­˜æ•°æ®ã€å‡å°‘æ•°æ®åº“æŸ¥è¯¢ç­‰

```js
const NodeCache = require("node-cache");
const cache = new NodeCache({
  stdTTL: 1800, // ç¼“å­˜é»˜è®¤è¿‡æœŸæ—¶é—´ï¼ˆå•ä½ç§’ï¼‰
  checkperiod: 60, // å®šæœŸæ£€æŸ¥è¿‡æœŸç¼“å­˜çš„æ—¶é—´ï¼ˆå•ä½ç§’ï¼‰
});
```

ä»¥æ˜é‡‘çƒ­æ¦œä¸ºä¾‹ï¼Œå½“è¯·æ±‚ `/juejin` æ—¶ï¼Œé¦–å…ˆä»ç¼“å­˜ä¸­è·å–æ•°æ®ï¼Œå¦‚æœç¼“å­˜å­˜åœ¨æ•°æ®ï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œå†è¿›è¡Œå¯¹æ•°æ®æ¥å£çš„è¯·æ±‚ï¼Œè¯·æ±‚åæ›´æ–°ç¼“å­˜ï¼Œå¹¶è¿”å›æ•°æ®ï¼›
```js
// è°ƒç”¨è·¯å¾„
const url =
  "https://api.juejin.cn/content_api/v1/content/article_rank?category_id=1&type=hot";
// ç¼“å­˜é”®å
const cacheKey = "juejinData";

// æ˜é‡‘çƒ­æ¦œ
juejinRouter.get("/juejin", async (ctx) => {
    // ä»ç¼“å­˜ä¸­è·å–æ•°æ®
    let data = await get(cacheKey);
    const from = data ? "cache" : "server";
    if (!data) {
      // å¦‚æœç¼“å­˜ä¸­ä¸å­˜åœ¨æ•°æ®
      console.log("ä»æœåŠ¡ç«¯é‡æ–°è·å–æ˜é‡‘çƒ­æ¦œ");
      // ä»æœåŠ¡å™¨æ‹‰å–æ•°æ®
      const response = await axios.get(url);
      data = getData(response.data.data);
      // å°†æ•°æ®å†™å…¥ç¼“å­˜
      await set(cacheKey, data);
    }
    ctx.body = {
      // .... other params
      data,
    };
})
```

#### æ£€æµ‹ç«¯å£æ˜¯å¦å ç”¨
æ£€æµ‹ç«¯å£æ˜¯å¦å ç”¨ï¼Œæ˜¯é€šè¿‡åˆ›å»ºäº†ä¸€ä¸ª net.Server å¯¹è±¡ï¼Œå¹¶å°è¯•åœ¨æŒ‡å®šç«¯å£ä¸Šå¯åŠ¨è¯¥æœåŠ¡å™¨ã€‚
å¦‚æœç«¯å£å·²ç»è¢«å ç”¨ï¼Œåˆ™ä¼šè§¦å‘ 'error' äº‹ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­é”™è¯¯ç æ˜¯å¦ä¸º 'EADDRINUSE' æ¥åˆ¤æ–­ç«¯å£æ˜¯å¦è¢«å ç”¨ã€‚å¦‚æœç«¯å£æœªè¢«å ç”¨ï¼Œåˆ™ä¼šè§¦å‘ 'listening' äº‹ä»¶

```js
// æ£€æµ‹ç«¯å£æ˜¯å¦è¢«å ç”¨
const net = require("net");

const checkPort = (port) => {
  return new Promise((resolve, reject) => {
    const server = net
      .createServer()
      .once("error", (err) => {
        if (err.code === "EADDRINUSE") {
          console.log(`ç«¯å£ ${port} å·²è¢«å ç”¨, æ­£åœ¨å°è¯•å…¶ä»–ç«¯å£...`);
          server.close();
          resolve(false);
        } else {
          reject(err);
        }
      })
      .once("listening", () => {
        server.close();
        resolve(true);
      })
      .listen(port);
  });
};
```





## å‚è€ƒ

[DailyHot](https://github.com/imsyy/DailyHotApi)

[DailyHotApi](https://github.com/imsyy/DailyHotApi)

[uni-appä»‹ç»æ–‡æ¡£](https://uniapp.dcloud.net.cn/)

[å®‰è£…æ¨¡æ‹Ÿå™¨](https://uniapp.dcloud.net.cn/tutorial/run/installSimulator.html)

[Android Studioä¸‹è½½SDKèµ„æºé€Ÿåº¦æ…¢æ€ä¹ˆåŠ](https://www.jianshu.com/p/c93fea637566)

[uni-appä¸­ä½¿ç”¨webviewåŠ è½½ç½‘é¡µï¼Œæ”¯æŒåé€€å’Œå…³é—­](https://ask.dcloud.net.cn/article/37714)
